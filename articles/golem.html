<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using reactor with golem • reactor</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using reactor with golem">
<meta property="og:description" content="reactor">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">reactor</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/golem.html">Using reactor with golem</a>
    </li>
    <li>
      <a href="../articles/simple_example.html">Simple Example</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/yonicd/reactor/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="golem_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using reactor with golem</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/yonicd/reactor/blob/master/vignettes/golem.Rmd"><code>vignettes/golem.Rmd</code></a></small>
      <div class="hidden name"><code>golem.Rmd</code></div>

    </div>

    
    
<div id="reactor-and-golem" class="section level2">
<h2 class="hasAnchor">
<a href="#reactor-and-golem" class="anchor"></a>Reactor and Golem</h2>
<p>Reactor is built to run regular Shiny Applications and ones that are packaged using the golem package.</p>
<p>In this example we are using package called <a href="https://github.com/yonicd/puzzlemath">puzzlemath</a>.</p>
<div id="puzzlemath" class="section level3">
<h3 class="hasAnchor">
<a href="#puzzlemath" class="anchor"></a>Puzzlemath</h3>
<p>This application is made for creating simple arithmetic questions for the user and given a correct answer a piece of the “puzzle” is revealed to the user.</p>
<p>The user can control the application using the following inputs:</p>
<ul>
<li>
<code>game</code>: action button that invokes a new game</li>
<li>
<code>draw</code>: action button that draws a new question in a game</li>
<li>
<code>ans</code>: textInput that the user types in the answer to a question</li>
<li>
<code>range</code>: a slider that controls the range of values that the questions can be drawn from. Interacting with this input will invoke a new game.</li>
<li>
<code>n</code>: a slider that controls the number of questions to use in the game. Interacting with this input will invoke a new game.</li>
<li>
<code>signs</code>: radiobuttons that control which operator signs to construct the questions from (+,-,*,/). The user can click on the buttons to toggle the operator on or off. Interacting with this input will invoke a new game.</li>
</ul>
<p>The application has the following outputs:</p>
<ul>
<li>
<code>plot</code>: renderPlot object that displays the puzzle</li>
<li>
<code>ques</code>: verbatimText object that displays the current question</li>
<li>
<code>anspanel</code>: wellPanel that encloses the <code>ans</code> object.</li>
</ul>
</div>
<div id="whereami-observers" class="section level3">
<h3 class="hasAnchor">
<a href="#whereami-observers" class="anchor"></a>whereami observers</h3>
<p><a href="https://github.com/yonicd/whereami">whereami</a> observers are placed in the reactive part of the application to log when chunks are being triggered by shiny.</p>
<p>We use this in order to track reactivity while the application is running and test expected reactivity against it.</p>
<p>The observers placed in <code>puzzlemath</code> are placed in the following places in order to test the reactivity of the plotting and when new questions are drawn.</p>
<ul>
<li><p><a href="https://github.com/yonicd/puzzlemath/blob/main/R/mod_plot.R#L31">renderPlot</a></p></li>
<li><p><a href="https://github.com/yonicd/puzzlemath/blob/main/R/app_server.R#L35">observeEvent for input$draw</a></p></li>
</ul>
</div>
</div>
<div id="testing-reactivity-with-reactor" class="section level2">
<h2 class="hasAnchor">
<a href="#testing-reactivity-with-reactor" class="anchor"></a>Testing Reactivity with Reactor</h2>
<div id="intialize-reactor" class="section level3">
<h3 class="hasAnchor">
<a href="#intialize-reactor" class="anchor"></a>Intialize reactor</h3>
<p>reactor starts with initialization of the reactor object and populating the application and the webdriver fields. In this example we are using a golem based application and a chrome webdriver.</p>
<p>RSelenium will run more consistently with an explicit assignment of the web driver version. For this reactor comes with it a function that returns the version of chrome that is installed on the system <code><a href="../reference/chrome_version.html">chrome_version()</a></code>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/yonicd/reactor">reactor</a></span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/init_reactor.html">init_reactor</a></span><span class="op">(</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_golem_args.html">set_golem_args</a></span><span class="op">(</span>
    package_name <span class="op">=</span> <span class="st">'puzzlemath'</span>
  <span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_chrome_driver.html">set_chrome_driver</a></span><span class="op">(</span>
    chromever <span class="op">=</span> <span class="fu"><a href="../reference/chrome_version.html">chrome_version</a></span><span class="op">(</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
</div>
<div id="starting-reactor" class="section level3">
<h3 class="hasAnchor">
<a href="#starting-reactor" class="anchor"></a>Starting reactor</h3>
<p>Once the reactor fields are populated reactor can be started. This step will create two child processes one for hosting the application and the other for hosting the webdriver to interact with the application.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/start_reactor.html">start_reactor</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
<div id="testing-reactivity-at-application-startup" class="section level3">
<h3 class="hasAnchor">
<a href="#testing-reactivity-at-application-startup" class="anchor"></a>Testing reactivity at application startup</h3>
<p>Usually there are reactive components being invalidated at application startup. For this app the inputs plot and draw are both expected to be invalidated once.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'plot'</span>,<span class="fl">1</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'draw'</span>,<span class="fl">1</span><span class="op">)</span></code></pre></div>
</div>
<div id="sending-commands-to-the-application" class="section level3">
<h3 class="hasAnchor">
<a href="#sending-commands-to-the-application" class="anchor"></a>Sending Commands to the Application</h3>
<p>We now want to do something in the application, click the draw button. Once it is clicked we are expecting a new question to be drawn, but not rerendering the plot.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/click_id.html">click_id</a></span><span class="op">(</span><span class="st">'draw'</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'plot'</span>,<span class="fl">1</span><span class="op">)</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'draw'</span>,<span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>The application has a sliderInput object with the id ‘range’ which controls the range of values that can be used in each question. Once it is clicked a new game is created and a question is drawn. We test that following expectation.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_id_value.html">set_id_value</a></span><span class="op">(</span><span class="st">'range'</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'plot'</span>,<span class="fl">2</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/expect_reactivity.html">expect_reactivity</a></span><span class="op">(</span><span class="st">'draw'</span>,<span class="fl">3</span><span class="op">)</span></code></pre></div>
</div>
<div id="querying-the-application" class="section level3">
<h3 class="hasAnchor">
<a href="#querying-the-application" class="anchor"></a>Querying the Application</h3>
<p>Now we are interested in querying the value of a question in order to send correct value to the appropriate textInput with an id ‘ans’.</p>
<p>We can do this with <code><a href="../reference/query.html">query_output_id()</a></code> using the ‘ques’ id, the result is in the form of a question, e.g. ‘3 + 1 ?’</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">current_ans</span> <span class="op">&lt;-</span> <span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/query.html">query_output_id</a></span><span class="op">(</span><span class="st">'ques'</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/grep.html">gsub</a></span><span class="op">(</span><span class="st">'\\?'</span>,<span class="st">''</span>,<span class="va">.</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/parse.html">parse</a></span><span class="op">(</span>text <span class="op">=</span> <span class="va">.</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/eval.html">eval</a></span><span class="op">(</span><span class="op">)</span>

<span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/set_id_value.html">set_id_value</a></span><span class="op">(</span><span class="st">'ans'</span>,<span class="va">current_ans</span><span class="op">)</span></code></pre></div>
<p>Given the correct answer the app is supposed to change the border of the div surrounding the textInput with the color green, rgb (0,128,0). We can send a query to the app using JavaScript functions and return the value to R. The argument flatten is used to unlist the result and return the character.</p>
<p>We can test this expectation using testthat expectations.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/query.html">query</a></span><span class="op">(</span><span class="st">"$('#anspanel').css('border-color')"</span>,flatten <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">%&gt;%</span>
  <span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/equality-expectations.html">expect_equal</a></span><span class="op">(</span>expected <span class="op">=</span> <span class="st">"rgb(0, 128, 0)"</span><span class="op">)</span></code></pre></div>
</div>
<div id="closing-reactor" class="section level3">
<h3 class="hasAnchor">
<a href="#closing-reactor" class="anchor"></a>Closing Reactor</h3>
<p>To cleanly close reactor we run the following.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">obj</span><span class="op">%&gt;%</span>
  <span class="fu"><a href="../reference/kill_app.html">kill_app</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Sidi.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
